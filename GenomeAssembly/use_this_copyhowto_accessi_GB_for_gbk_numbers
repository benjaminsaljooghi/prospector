DOwnloading and manipulating data files:

1. Go to ftp://ftp.ncbi.nlm.nih.gov/genomes/Bacteria/
2. Search the required name
3. Click on file. rpt (report)
4. Select the GI number, accession number and Name (seeexample of Bacillus subtilis, below):

FOR DOWNLOADING GENOMES FROM "BACTERIA", USE GI NUMBER OR ACCESSION NUMBER: 
	   GI		  Accession		        Name
	255767013	NC_000964.gbk	Bacillus subtilis subsp. subtilis str. 168
	449092714	NC_017196.gbk	Bacillus subtilis XF-1
	430755491	NC_019896.gbk	Bacillus subtilis subsp. subtilis str. BSP1
	384173661	NC_020244.gbk	Bacillus subtilis subsp. subtilis str. RO-NN-1
	470160151	NC_020507.gbk	Bacillus subtilis subsp. subtilis 6051-HGW
	472328503	NC_020832.gbk 	Bacillus subtilis subsp. subtilis str. BAB-1
	321311376	NC_014976.gbk	Bacillus subtilis BSn5
	350264100	NC_014479.gbk	Bacillus subtilis subsp. spizizenii str. W23
	305672698	NC_016047.gbk	Bacillus subtilis subsp. spizizenii TU-B-10
	428277412	NC_017194.gbk	Bacillus subtilis subsp. natto BEST195
	402774243	NC_018520.gbk	Bacillus subtilis QB928
	560127023	NC_022898.gbk	Bacillus subtilis PY79

FOR DOWNLOADING GENOMES FROM "BACETRIA DRAFT", USE ONLY ACCESSION NUMBER WITHOUT THE VERSION NUMBER DENOTED by .1. 
	296333521 	NZ_ADGS00000000.1	Bacillus subtilis subsp. spizizenii ATCC 6633
	443635203 	NZ_AMXN00000000.1	Bacillus subtilis subsp. inaquosorum KCTC 13429i
	194372944	NZ_ABQN00000000.1	Bacillus subtilis subsp. subtilis str. SMY
	418034832	NZ_AGFW00000000.1	Bacillus subtilis subsp. subtilis str. SC-8
	484071004	NZ_ANIP00000000.1	Bacillus subtilis S1-4
	194373039	NZ_ABQL00000000.1	Bacillus subtilis subsp. subtilis str. NCIB 3610
	452916715	NZ_AOTY00000000.1	Bacillus subtilis MB73/2
	194372954	NZ_ABQM00000000.1	Bacillus subtilis subsp. subtilis str. JH642
	194373045	NZ_ABQK00000000.1	Bacillus subtilis subsp. subtilis str. 168
	386756580	NC_017743.1		Bacillus sp. JS 

5. Download the Genbank files:
	gkb_get -a GI number OR Accession number > GI.gbk OR Accession.gbk

6. Rewrite the organism name (the first line from the GenBank file):
	gbk_ExtractName GI NUmber.gbk OR Accession Number.gbk 
	mkdir ORIGINAL and mv NC*.gbk to the directory ORIGINAL
	mdir RENAMED and mv Bacillus*.gbk to the directory RENAMED
		To extract genes and proteins from the renamed gbk files: gbk_ExtractGeneProt filename.gbk 
			Genes (filename.fna) and protein files (file.fsa) will be created 
			grep -c to find out the numbers of proteins
			aminoacidUsagePlot to find amino acid usage

7. Convert GenBank files to fasta DNA and mv *.gbk.dna to /DNA_FROM_GBK 
	cd RENAMED
	for x in *.gbk; do echo $x; saco_convert -I genbank -O fasta $x > $x.dna; done (converts gbk to fasta.dna)
	mkdir DNA_FROM_GBK (to make new directory)
	 mv *.gbk.dna ../DNA_FROM_GBK (to move all the files to the directory)

8. From the directory DNA_FROM_GBK, the following data can be obtained. 
	cd to /DNA_FROM_GBK
	To extract genome statistics: for x in *.gbk.dna; do echo $x; stats_genomeDNA $x >> genomeStat.all; done 
		Open GenomeStat.all usning LibreCal or Excel
	To extract rRNA genes: 
		for x in Bacillus_s*gbk.dna ; do echo $x; rnammer -S bac -m ssu -f $x.rrna $x; done
		mdkir rRNA and mv Bacillus_s*.dna.rrna to the dir rRNA 
	To align and draw trees:
		To be added later

9. Gene Finding in filename.gbk.dna
	cd / DNA_FRM_GBK
	for x in *.gbk.dna; do prodigalrunner $x ; done

The following files are produced; do as per the instructions in brackets (..)
	file.gff (delete, not required; rm *.gff)
	file_prodigal.gbk (delete, not required, rm *_prodigal.gbk)
	file_prodigal.orf.fna (gene, mkdir PRODIGAL_GENES and mv *_prodigal.orf.fna to this directory)  
	file_prodigal.orf.fsa (protein, mkdir PRODIGAL_PROTEINS and mv *_prodigal.orf.fsa to this directory)
	
	cd to PRODIGAL_GENES and 
	$ for x in *.fna; do echo $x; echo $x >> proteinCounts.txt; grep -c ">" $x >> proteinCounts.txt; done 
	  proteinCounts.txt will be created which will list the nos. of proteins for each organism (= to same nos in PRODIGAL_PROTEINS)

10. Performing Pan and Core Genome Analysis:
	pancoreplot input file

NOTES: 
(a) Input file contains two columns - 1st column is a genome description and can not contain space or tab. The 2nd column is the file name, if the script is run in the same directory as the file

	# Description Filename
		CNRZ1066	Streptococcus_thermophilus_CNRZ1066_ID_58221_prodigal.orf.fsa
		JIM_8232	Streptococcus_thermophilus_JIM_8232_ID_68521_prodigal.orf.fsa
		LMD-9	        Streptococcus_thermophilus_LMD-9_ID_13773_prodigal.orf.fsa
		LMG_18311	Streptococcus_thermophilus_LMG_18311_ID_58219_prodigal.orf.fsa
		ND03	        Streptococcus_thermophilus_ND03_ID_49149_prodigal.orf.fsa

(b) Input file contains two columns - 1st column is a genome description and can not contain space or tab. The The 2nd column is a complete file path if the script is run from a different directory: 

 	$Description File_path
		CNRZ1066	/home/student/Strept_thermophilus_CNRZ1066_ID_58221_prodigal.orf.fsa
		JIM_8232	/home/student/Strep_thermophilus_JIM_8232_ID_68521_prodigal.orf.fsa
		LMD-9	        /home/student/Strep_thermophilus_LMD-9_ID_13773_prodigal.orf.fsa
		LMG_18311	/home/student/Strept_thermophilus_LMG_18311_ID_58219_prodigal.orf.fsa
		ND03            /home/student/Strep_thermophilus_ND03_ID_49149_prodigal.orf.fsa

(c) The input file can be made using an editor or using the following
	ls -1 *orf.fsa | gawk '{print $1 "\t" $1}' > pancore.list
	vi pancore.list to make any changes




dr-xr-xr-x   4 ftp      anonymous     4096 Aug 19 21:59 Halomonas_alkaliantarctica
dr-xr-xr-x   4 ftp      anonymous     4096 Aug 19 21:20 Halomonas_anticariensis
dr-xr-xr-x   5 ftp      anonymous     4096 Aug 19 20:42 Halomonas_boliviensis
dr-xr-xr-x   4 ftp      anonymous     4096 Aug 19 21:53 Halomonas_campaniensis
dr-xr-xr-x   5 ftp      anonymous     4096 Aug 19 20:39 Halomonas_elongata
dr-xr-xr-x   4 ftp      anonymous     4096 Aug 19 21:25 Halomonas_halocynthiae
dr-xr-xr-x   4 ftp      anonymous     4096 Aug 19 21:46 Halomonas_halodenitrificans
dr-xr-xr-x   5 ftp      anonymous     4096 Aug 19 21:07 Halomonas_jeotgali
dr-xr-xr-x   5 ftp      anonymous     4096 Aug 19 21:08 Halomonas_lutea
dr-xr-xr-x   3 ftp      anonymous     4096 Sep 30 21:18 Halomonas_salina
dr-xr-xr-x   5 ftp      anonymous     4096 Aug 19 21:07 Halomonas_smyrnensis
dr-xr-xr-x   4 ftp      anonymous     4096 Aug 19 21:46 Halomonas_sp._19A_GOM-1509m
dr-xr-xr-x   4 ftp      anonymous     4096 Aug 19 21:38 Halomonas_sp._23_GOM-1509m
dr-xr-xr-x   4 ftp      anonymous     4096 Aug 19 21:42 Halomonas_sp._BC04
dr-xr-xr-x   4 ftp      anonymous     4096 Aug 19 21:28 Halomonas_sp._BJGMM-B45
dr-xr-xr-x   4 ftp      anonymous     4096 Aug 19 20:42 Halomonas_sp._GFAJ-1
dr-xr-xr-x   4 ftp      anonymous     4096 Aug 19 20:42 Halomonas_sp._HAL1
dr-xr-xr-x   4 ftp      anonymous     4096 Aug 19 21:52 Halomonas_sp._HL-48
dr-xr-xr-x   4 ftp      anonymous     4096 Aug 19 20:45 Halomonas_sp._KM-1
dr-xr-xr-x   4 ftp      anonymous     4096 Aug 19 22:01 Halomonas_sp._KO116
dr-xr-xr-x   4 ftp      anonymous     4096 Aug 19 21:31 Halomonas_sp._PBN3
dr-xr-xr-x   4 ftp      anonymous     4096 Aug 19 22:01 Halomonas_sp._SUBG004
dr-xr-xr-x   5 ftp      anonymous     4096 Aug 19 20:41 Halomonas_sp._TD01
dr-xr-xr-x   4 ftp      anonymous     4096 Aug 30 15:04 Halomonas_sp._TG39a
dr-xr-xr-x   5 ftp      anonymous     4096 Aug 19 21:09 Halomonas_stevensii
dr-xr-xr-x   5 ftp      anonymous     4096 Aug 19 20:59 Halomonas_titanicae
dr-xr-xr-x   3 ftp      anonymous     4096 Sep 30 21:56 Halomonas_xinjiangensis
dr-xr-xr-x   5 ftp      anonymous     4096 Aug 19 21:08 Halomonas_zhanjiangensis
dr-xr-xr-x   4 ftp      anonymous     4096 Aug 19 22:01 Halomonas_zincidurans


================================================================================================


NOTES FROM JOSEPH:


Dear Bharat

I've looked into methods for getting the data from NCBI ftp server and found an FTP client called ncftp that is more efficient than using wget.

you can get ncftp by using apt-get i.e.

$sudo apt-get install ncftp

once installed it runs as a shell in terminal

to start:

$ncftp  #opens the program as the prompt shell

connect to ncbi ftp server:

ncftp > open ftp.ncbi.nlm.nih.gov

# use the usual command 'ls, cd, pwd' etc to navigate the remote server "ncbi server"
# to navigate through your own directories add 'l' "for local" infront of the same commands

e.g.

ncftp > lcd /home # change to home directory
ncftp > lmkdir 'directoryname' $ make a new directory

To download files from the remote server use the 'get' command:

ncftp > get 'filename'

or

ncftp > /genomes/genbank/Bacteria/Bacillus_subtilis/filename

_______________________________________________________________

The good thing about this client is the familiarity to the normal unix shell command and you can use wildcards '*' to grab whole directories of files, "doesn't want to download files if the directory path is too long, only too directories up".

As for the NCBI FTP server itself:

ftp.ncbi.nlm.nih.gov/genomes/

The old genome directories are becoming redundant and replaced with three new directories: "all" "refseq" and "genbank". The old directory structures that included "Bacteria" "Bacteria_DRAFT" only include the old files "which is why the draft genomes contigs were split into separate files".

the "all" directory

/genomes/all

all subdirectories are named by genbank IDs only and not subdivided into different genus "very hard to use"

the "refseq" and "genbank" directories

/genomes/refseq
/genomes/genbank

are subdivided into domains then into genus. The genbank directory seems to include all relevant data for our analysis, the refseq directory includes a smaller subset i.e. less genomes than the genbank directory "I'm guessing better curated data".  However, the good thing about theses new directories is you can get all the most recent assemblies and annotated data. The contigs or scaffolds for each genomes come in one .fna file that is compressed into a .tar file.

So using ncftp, I was able to download all genome entries "and associated files" relevant to Bacillus subtilis species into their individual directories using the following command:

ncftp > get -R /genomes/genbank/bacteria/Bacillus_subtilis/latest_assembly_versions/*

# this would be after connecting to the ftp server and from it's highest directory of course. the '-R' recursive qualifier grabs all files in the directory recursively

you could also change the genus_species identifier to grab the files from another species e.g.

ncftp > get -R /genomes/genbank/Bacillus_sp._JS/latest_assembly_versions

For me the Bacillus_subtilis directory within the genbank directory contained 50 different genomes including D7XPN1.

Regards

Joseph Adelskov 






=================================================================================================
NOTES:
$awk ‘{print $1, $5, $7}’ data_file 
	Print column1, column5 and column7 of a data file or output of any columns list

SCRIPTING:
1. Constructs
for file in `ls`
do
    echo $file
done

count=0
while [ $count -lt 5 ]; do
    echo $count
    sleep 1
    count=$(($count + 1))
done

myfunction() {
    find . -type f -name "*.$1" -print       # $1 is first argument of the function
}
myfunction "txt"


2. Some awk commands
Awk is useful for field stripping, like cut in a more powerful way. Search this document for other examples. See for example gnulamp.com and one-liners for awk for some nice examples.

awk '{ print $2, $1 }' file                  # Print and inverse first two columns
awk '{printf("%5d : %s\n", NR,$0)}' file     # Add line number left aligned
awk '{print FNR "\t" $0}' files              # Add line number right aligned
awk NF test.txt                              # remove blank lines (same as grep '.')
awk 'length > 80'                            # print line longer than 80 char)

3. Some sed commands
Here is the one liner gold minehttp://student.northpark.edu/pemente/sed/sed1line.txt. And a good introduction and tutorial to sedhttp://www.grymoire.com/Unix/Sed.html.

sed 's/string1/string2/g'                    # Replace string1 with string2
sed -i 's/wroong/wrong/g' *.txt              # Replace a recurring word with g
sed 's/\(.*\)1/\12/g'                        # Modify anystring1 to anystring2
sed '/<p>/,/<\/p>/d' t.xhtml                 # Delete lines that start with <p>
                                             # and end with </p>
sed '/ *#/d; /^ *$/d'                        # Remove comments and blank lines
sed 's/[ \t]*$//'                            # Remove trailing spaces (use tab as \t)
sed 's/^[ \t]*//;s/[ \t]*$//'                # Remove leading and trailing spaces
sed 's/[^*]/[&]/'                            # Enclose first char with [] top->[t]op
sed = file | sed 'N;s/\n/\t/' > file.num     # Number lines on a file


 
